<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Width Test</title>
    <style>
        :root {
            --dracula-bg: #282a36;
            --dracula-current-line: #44475a;
            --dracula-foreground: #f8f8f2;
            --dracula-comment: #6272a4;
            --dracula-cyan: #8be9fd;
            --dracula-green: #50fa7b;
            --dracula-orange: #ffb86c;
            --dracula-pink: #ff79c6;
            --dracula-purple: #bd93f9;
            --dracula-red: #ff5555;
            --dracula-yellow: #f1fa8c;
        }
        
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            margin: 0;
            padding: 20px;
            background: var(--dracula-bg);
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255, 184, 108, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(139, 233, 253, 0.1) 0%, transparent 50%);
            color: var(--dracula-foreground);
            min-height: 100vh;
        }
        
        h1 {
            color: var(--dracula-orange);
            text-shadow: 0 2px 8px rgba(255, 184, 108, 0.3);
            text-align: center;
        }
        
        .container {
            background: rgba(68, 71, 90, 0.6);
            backdrop-filter: blur(12px);
            padding: 35px;
            border-radius: 20px;
            border: 1px solid rgba(255, 184, 108, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 4px 16px rgba(255, 184, 108, 0.1),
                inset 0 1px 0 rgba(248, 248, 242, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            margin: 20px 0;
        }
        .test-output {
            background: rgba(40, 42, 54, 0.9);
            color: var(--dracula-foreground);
            padding: 25px;
            border-radius: 12px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            margin: 20px 0;
            border: 2px solid var(--dracula-cyan);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.3),
                0 2px 8px rgba(139, 233, 253, 0.2),
                inset 0 1px 0 rgba(248, 248, 242, 0.05);
        }
        .back-link {
            display: inline-block;
            background: linear-gradient(145deg, var(--dracula-comment), #5a6374);
            color: var(--dracula-foreground);
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 10px;
            margin: 12px 0;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 4px 16px rgba(98, 114, 164, 0.2),
                0 2px 8px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .back-link:hover {
            background: linear-gradient(145deg, #5a6374, var(--dracula-comment));
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px rgba(98, 114, 164, 0.3),
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div style="text-align: left; margin: 0 0 30px 0;">
        <a href="index.html" class="back-link">&larr; Back to Test Directory</a>
    </div>
    
    <h1>&#129514; Emoji Width Test</h1>
    
    <div class="container">
        <h2>Testing Emoji Alignment in Tables</h2>
        <p>This test demonstrates how emojis are processed by the WASM module and converted to HTML, with proper font support for Unicode characters.</p>
        
        <h3>Test Results:</h3>
        <div class="test-output" id="output">Loading...</div>
        
        <div style="margin-top: 20px;">
            <strong>Font Support:</strong> This page now uses emoji-compatible fonts (Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji) to properly display Unicode characters. If emojis still cause errors, the test will automatically fall back to ASCII-safe symbols.
        </div>
        
    </div>

    <script type="module">
        import init, { WasmTable, convertAnsiToHtml } from './pkg/ascii_ansi_table.js';
        
        async function runEmojiTest() {
            await init();
            
            // Create test data with emojis - now with proper font support
            const testData = [
                ['Status', 'Task', 'Progress'],
                ['üü¢ Done', 'Setup project', '100%'],
                ['üöÄ Active', 'Build features', '75%'],
                ['üü° Pending', 'Write tests', '50%'],
                ['üì¶ Shipped', 'Deploy code', '100%'],
                ['üéØ Planning', 'Next phase', '25%']
            ];
            
            console.log('Original test data:', testData);
            
            // Alternative ASCII-safe test data (fallback if emojis still don't work)
            const fallbackTestData = [
                ['Status', 'Task', 'Progress'],
                ['‚úì Done', 'Setup project', '100%'],
                ['‚Üí Active', 'Build features', '75%'],
                ['! Pending', 'Write tests', '50%'],
                ['* Shipped', 'Deploy code', '100%'],
                ['+ Planning', 'Next phase', '25%']
            ];
            
            try {
                const table = new WasmTable();
                table.setData(testData);
                
                const rawOutput = table.render();
                console.log('Raw WASM output:', rawOutput);
                
                const htmlOutput = convertAnsiToHtml(rawOutput);
                console.log('HTML output:', htmlOutput);
                
                // Create a more detailed diagnostic output
                const outputDiv = document.getElementById('output');
            
            let diagnosticHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--dracula-orange);">&#128203; Diagnostic Information:</h4>
                    <div style="background: rgba(68, 71, 90, 0.8); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <strong>Test emojis:</strong> &#128994; &#128640; &#128993; &#128230; &#127919;<br>
                        <strong>Unicode codes:</strong> U+1F7E2 U+1F680 U+1F7E1 U+1F4E6 U+1F3AF
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--dracula-cyan);">&#128269; Raw Table Output:</h4>
                    <pre style="background: rgba(40, 42, 54, 0.9); padding: 15px; border-radius: 8px; font-size: 12px; overflow-x: auto;">${rawOutput.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
                </div>
                <div>
                    <h4 style="color: var(--dracula-green);">&#127912; Converted HTML Output:</h4>
                    <div style="background: rgba(40, 42, 54, 0.9); padding: 15px; border-radius: 8px;">
                        ${htmlOutput}
                    </div>
                </div>
            `;
            
            outputDiv.innerHTML = diagnosticHTML;
            
            // Check if emojis are wrapped and what they actually contain
            const hasEmojiSpans = htmlOutput.includes('width: 2ch');
            if (hasEmojiSpans) {
                console.log('‚úÖ Emojis are properly wrapped with fixed width!');
            } else {
                console.log('‚ùå Emoji wrapping not found');
                console.log('Checking for emoji presence in output...');
                
                // Check what characters are actually in the output
                const emojiRegex = /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu;
                const foundEmojis = rawOutput.match(emojiRegex);
                console.log('Found emoji characters:', foundEmojis);
            }
            } catch (error) {
                console.error('Error during emoji test:', error);
                console.log('Trying fallback with ASCII-safe symbols...');
                
                // Try with fallback data if emojis still cause issues
                try {
                    const fallbackTable = new WasmTable();
                    fallbackTable.setData(fallbackTestData);
                    
                    const fallbackRawOutput = fallbackTable.render();
                    const fallbackHtmlOutput = convertAnsiToHtml(fallbackRawOutput);
                    
                    const outputDiv = document.getElementById('output');
                    outputDiv.innerHTML = `
                        <div style="background: linear-gradient(145deg, rgba(241, 250, 140, 0.15), rgba(241, 250, 140, 0.05)); padding: 20px; border-radius: 12px; border: 1px solid rgba(241, 250, 140, 0.4); color: var(--dracula-foreground);">
                            <h4 style="color: var(--dracula-yellow); margin-top: 0;">&#9888; Fallback Test Results</h4>
                            <p><strong>Original Error:</strong> ${error.message}</p>
                            <p>Emojis caused control character errors, so we're showing results with ASCII-safe symbols instead.</p>
                        </div>
                        <div style="margin: 20px 0;">
                            <h4 style="color: var(--dracula-cyan);">&#128269; Fallback Table Output:</h4>
                            <pre style="background: rgba(40, 42, 54, 0.9); padding: 15px; border-radius: 8px; font-size: 12px; overflow-x: auto;">${fallbackRawOutput.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
                        </div>
                        <div>
                            <h4 style="color: var(--dracula-green);">&#127912; Converted HTML Output:</h4>
                            <div style="background: rgba(40, 42, 54, 0.9); padding: 15px; border-radius: 8px;">
                                ${fallbackHtmlOutput}
                            </div>
                        </div>
                    `;
                } catch (fallbackError) {
                    const outputDiv = document.getElementById('output');
                    outputDiv.innerHTML = `
                        <div style="background: linear-gradient(145deg, rgba(255, 85, 85, 0.15), rgba(255, 85, 85, 0.05)); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 85, 85, 0.4); color: var(--dracula-foreground);">
                            <h4 style="color: var(--dracula-red); margin-top: 0;">&#10060; Both Tests Failed</h4>
                            <p><strong>Emoji Error:</strong> ${error.message}</p>
                            <p><strong>Fallback Error:</strong> ${fallbackError.message}</p>
                            <p>Both emoji and ASCII-safe symbol tests failed. There may be a deeper issue with the WASM module.</p>
                        </div>
                    `;
                }
            }
        }
        
        runEmojiTest();
    </script>
</body>
</html>