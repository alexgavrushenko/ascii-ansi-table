<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII ANSI Table WASM - Streaming Demo</title>
    <style>
        :root {
            --dracula-bg: #282a36;
            --dracula-current-line: #44475a;
            --dracula-selection: #44475a;
            --dracula-foreground: #f8f8f2;
            --dracula-comment: #6272a4;
            --dracula-cyan: #8be9fd;
            --dracula-green: #50fa7b;
            --dracula-orange: #ffb86c;
            --dracula-pink: #ff79c6;
            --dracula-purple: #bd93f9;
            --dracula-red: #ff5555;
            --dracula-yellow: #f1fa8c;
        }
        
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: var(--dracula-bg);
            background-image: 
                radial-gradient(circle at 30% 30%, rgba(139, 233, 253, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 121, 198, 0.1) 0%, transparent 50%);
            color: var(--dracula-foreground);
            min-height: 100vh;
        }
        
        .container {
            background: rgba(68, 71, 90, 0.6);
            backdrop-filter: blur(12px);
            padding: 35px;
            border-radius: 20px;
            border: 1px solid rgba(139, 233, 253, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 4px 16px rgba(139, 233, 253, 0.1),
                inset 0 1px 0 rgba(248, 248, 242, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            margin-bottom: 25px;
        }
        
        h1 {
            color: var(--dracula-cyan);
            text-align: center;
            text-shadow: 0 2px 8px rgba(139, 233, 253, 0.3), 0 0 20px rgba(139, 233, 253, 0.2);
            border-bottom: 2px solid var(--dracula-cyan);
            padding-bottom: 15px;
            font-size: 2.2em;
            letter-spacing: -0.02em;
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        button {
            background: linear-gradient(145deg, var(--dracula-purple), var(--dracula-pink));
            color: var(--dracula-bg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            margin: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            box-shadow: 
                0 4px 16px rgba(189, 147, 249, 0.3),
                0 2px 8px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -2px 0 rgba(0, 0, 0, 0.2);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 24px rgba(189, 147, 249, 0.4),
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -2px 0 rgba(0, 0, 0, 0.2);
            background: linear-gradient(145deg, var(--dracula-pink), var(--dracula-purple));
        }
        
        button:disabled {
            background: linear-gradient(145deg, var(--dracula-comment), #5a6374);
            color: var(--dracula-selection);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .demo-output {
            background: rgba(40, 42, 54, 0.9);
            color: var(--dracula-foreground);
            padding: 25px;
            border-radius: 12px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            min-height: 450px;
            max-height: 650px;
            overflow-y: auto;
            border: 2px solid var(--dracula-cyan);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.3),
                0 2px 8px rgba(139, 233, 253, 0.2),
                inset 0 1px 0 rgba(248, 248, 242, 0.05);
        }
        
        .settings {
            background: linear-gradient(145deg, rgba(68, 71, 90, 0.8), rgba(68, 71, 90, 0.4));
            border: 1px solid rgba(139, 233, 253, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(248, 248, 242, 0.05);
        }
        
        .settings label {
            display: inline-block;
            margin: 5px 15px 5px 0;
            font-weight: bold;
        }
        
        .settings input, .settings select {
            margin: 0 10px;
            padding: 8px 12px;
            border: 1px solid rgba(139, 233, 253, 0.3);
            border-radius: 6px;
            background: rgba(40, 42, 54, 0.8);
            color: var(--dracula-foreground);
            font-family: inherit;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status.ready {
            background: linear-gradient(145deg, var(--dracula-green), #45e066);
            color: var(--dracula-bg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 8px rgba(80, 250, 123, 0.3);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .status.running {
            background: linear-gradient(145deg, var(--dracula-yellow), #f4e479);
            color: var(--dracula-bg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 8px rgba(241, 250, 140, 0.3);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .status.error {
            background: linear-gradient(145deg, var(--dracula-red), #e04545);
            color: var(--dracula-foreground);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 8px rgba(255, 85, 85, 0.3);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .warning {
            background: linear-gradient(145deg, rgba(241, 250, 140, 0.15), rgba(241, 250, 140, 0.05));
            border: 1px solid rgba(241, 250, 140, 0.4);
            color: var(--dracula-yellow);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 
                0 4px 16px rgba(241, 250, 140, 0.1),
                inset 0 1px 0 rgba(248, 248, 242, 0.05);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .back-link {
            display: inline-block;
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 6px;
            margin: 10px 0;
            transition: background 0.2s;
        }
        
        .back-link:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div style="text-align: left; margin: 0 0 30px 0;">
        <a href="index.html" class="back-link">&larr; Back to Test Directory</a>
    </div>
    
    <h1>üåä ASCII ANSI Table WASM - Streaming Demo</h1>
    
    <div class="container">
        <div class="warning">
            <strong>‚ö†Ô∏è Note:</strong> This demo simulates streaming behavior using regular table rendering. 
            Full streaming API implementation is pending (see TODO_JS.md).
        </div>
        
        <div class="settings">
            <h3>Demo Settings</h3>
            <label>Rows: <input type="number" id="rows" min="5" max="100" value="10"></label>
            <label>Delay (ms): <input type="number" id="delay" min="100" max="5000" value="1000"></label>
            <label>Colors: <input type="checkbox" id="colors" checked></label>
            <label>Border Style: 
                <select id="border">
                    <option value="honeywell">Honeywell (Default)</option>
                    <option value="ramac">RAMAC (ASCII)</option>
                </select>
            </label>
        </div>
        
        <div class="controls">
            <button id="start-demo" onclick="startStreamingDemo()" disabled>Start Streaming Demo</button>
            <button id="stop-demo" onclick="stopStreamingDemo()" disabled>Stop Demo</button>
            <button onclick="clearOutput()">Clear Output</button>
        </div>
        
        <div class="status" id="status">Loading WASM module...</div>
        
        <div class="demo-output" id="output"></div>
    </div>

    <script type="module">
        import init, { WasmTable, table, convertAnsiToHtml } from './pkg/ascii_ansi_table.js';
        import { createSimpleTable, createColorfulTable, measureTime } from './test-utils.js';
        
        let wasmModule = null;
        let streamingInterval = null;
        let currentRow = 0;
        let totalRows = 0;
        let tableData = [];
        
        async function initializeWasm() {
            try {
                wasmModule = await init();
                document.getElementById('status').textContent = 'Ready to start streaming demo';
                document.getElementById('status').className = 'status ready';
                document.getElementById('start-demo').disabled = false;
                return true;
            } catch (error) {
                document.getElementById('status').textContent = 'Failed to load WASM module: ' + error.message;
                document.getElementById('status').className = 'status error';
                console.error('WASM initialization failed:', error);
                return false;
            }
        }
        
        function generateStreamingData(rows, useColors) {
            const data = [];
            
            if (useColors) {
                data.push([
                    '\x1b[1m\x1b[34mTimestamp\x1b[0m',
                    '\x1b[1m\x1b[32mEvent\x1b[0m',
                    '\x1b[1m\x1b[33mStatus\x1b[0m',
                    '\x1b[1m\x1b[35mDetails\x1b[0m'
                ]);
            } else {
                data.push(['Timestamp', 'Event', 'Status', 'Details']);
            }
            
            const events = ['Login', 'Logout', 'Purchase', 'View', 'Error', 'Warning', 'Info'];
            const statuses = ['Success', 'Failed', 'Pending', 'Processing'];
            
            for (let i = 0; i < rows; i++) {
                const timestamp = new Date(Date.now() - (rows - i) * 60000).toISOString().slice(11, 19);
                const event = events[Math.floor(Math.random() * events.length)];
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                const details = `Event #${i + 1} - ${Math.random().toString(36).substring(7)}`;
                
                if (useColors) {
                    const statusColor = {
                        'Success': '\x1b[32m',
                        'Failed': '\x1b[31m',
                        'Pending': '\x1b[33m',
                        'Processing': '\x1b[36m'
                    }[status] || '\x1b[37m';
                    
                    data.push([
                        `\x1b[90m${timestamp}\x1b[0m`,
                        event,
                        `${statusColor}${status}\x1b[0m`,
                        details
                    ]);
                } else {
                    data.push([timestamp, event, status, details]);
                }
            }
            
            return data;
        }
        
        function renderProgressiveTable(data, currentRowCount) {
            const partialData = data.slice(0, currentRowCount + 1);
            const wasmTable = new WasmTable();
            
            try {
                wasmTable.setData(partialData);
                return wasmTable.render();
            } catch (error) {
                console.error('Table rendering error:', error);
                return `Error rendering table: ${error.message}`;
            }
        }
        
        window.startStreamingDemo = async function() {
            if (!wasmModule) {
                alert('WASM module not initialized');
                return;
            }
            
            totalRows = parseInt(document.getElementById('rows').value);
            const delay = parseInt(document.getElementById('delay').value);
            const useColors = document.getElementById('colors').checked;
            
            tableData = generateStreamingData(totalRows, useColors);
            currentRow = 0;
            
            document.getElementById('start-demo').disabled = true;
            document.getElementById('stop-demo').disabled = false;
            document.getElementById('status').textContent = `Streaming ${totalRows} rows...`;
            document.getElementById('status').className = 'status running';
            
            const output = document.getElementById('output');
            output.innerHTML = 'Starting streaming demo...\\n\\n';
            
            streamingInterval = setInterval(() => {
                currentRow++;
                
                if (currentRow > totalRows) {
                    stopStreamingDemo();
                    return;
                }
                
                const tableOutput = renderProgressiveTable(tableData, currentRow);
                
                const htmlOutput = convertAnsiToHtml(tableOutput);
                output.innerHTML = `<p>Streaming demo - Row ${currentRow}/${totalRows}</p><div>${htmlOutput}</div>`;
                
                output.scrollTop = output.scrollHeight;
                
                document.getElementById('status').textContent = 
                    `Streaming... ${currentRow}/${totalRows} rows (${Math.round((currentRow/totalRows)*100)}%)`;
                
            }, delay);
        };
        
        window.stopStreamingDemo = function() {
            if (streamingInterval) {
                clearInterval(streamingInterval);
                streamingInterval = null;
            }
            
            document.getElementById('start-demo').disabled = false;
            document.getElementById('stop-demo').disabled = true;
            
            if (currentRow >= totalRows) {
                document.getElementById('status').textContent = 'Streaming demo completed!';
                document.getElementById('status').className = 'status ready';
            } else {
                document.getElementById('status').textContent = 'Streaming demo stopped';
                document.getElementById('status').className = 'status ready';
            }
        };
        
        window.clearOutput = function() {
            document.getElementById('output').innerHTML = '';
            if (streamingInterval) {
                stopStreamingDemo();
            }
        };
        
        async function runPerformanceTest() {
            if (!wasmModule) return;
            
            const testData = generateStreamingData(100, true);
            const wasmTable = new WasmTable();
            
            const { result, time } = await measureTime(() => {
                wasmTable.setData(testData);
                return wasmTable.render();
            });
            
            console.log(`Performance test: 100 rows rendered in ${time.toFixed(2)}ms`);
            
            const output = document.getElementById('output');
            output.innerHTML += `\\n\\n--- Performance Test ---\\nRendered 100 rows in ${time.toFixed(2)}ms\\n\\n`;
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const controls = document.querySelector('.controls');
            const perfButton = document.createElement('button');
            perfButton.textContent = 'Run Performance Test';
            perfButton.onclick = runPerformanceTest;
            controls.appendChild(perfButton);
        });
        
        initializeWasm();
    </script>
</body>
</html>