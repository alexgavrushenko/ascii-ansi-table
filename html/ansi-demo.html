<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII ANSI Table WASM - ANSI Color Demo</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1, h2 {
            color: #333;
            text-align: center;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .ansi-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            margin: 15px 0;
            border: 2px solid #007acc;
        }
        
        .html-output {
            background: white;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            white-space: pre-wrap;
            margin: 15px 0;
            overflow-x: auto;
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status.ready {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .color-sample {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            text-align: center;
            font-weight: bold;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .feature-list {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .feature-list ul {
            margin: 0;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <h1>üé® ASCII ANSI Table WASM - ANSI Color Demo</h1>
    
    <div class="container">
        <div class="status" id="status">Loading WASM module...</div>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Note:</strong> This demo shows ANSI color support in table rendering. 
            Full ANSI-to-HTML conversion is pending implementation (see TODO_JS.md).
        </div>
        
        <div class="feature-list">
            <h3>Supported ANSI Features:</h3>
            <ul>
                <li>Basic 8-color palette (30-37, 40-47)</li>
                <li>Bold text (1m)</li>
                <li>Underline text (4m)</li>
                <li>Italic text (3m)</li>
                <li>256-color palette (38;5;n, 48;5;n)</li>
                <li>True color RGB (38;2;r;g;b, 48;2;r;g;b)</li>
                <li>Text decorations (strikethrough, dim, reverse)</li>
            </ul>
        </div>
        
        <div class="controls">
            <button id="demo-basic" onclick="demoBasicColors()" disabled>Basic Colors</button>
            <button id="demo-formatting" onclick="demoFormatting()" disabled>Text Formatting</button>
            <button id="demo-256" onclick="demo256Colors()" disabled>256 Colors</button>
            <button id="demo-true" onclick="demoTrueColor()" disabled>True Color</button>
            <button id="demo-complex" onclick="demoComplexTable()" disabled>Complex Example</button>
            <button onclick="clearOutputs()">Clear All</button>
        </div>
    </div>
    
    <div class="container">
        <h2>Demo Outputs</h2>
        <div id="demo-outputs"></div>
    </div>

    <script type="module">
        import init, { WasmTable, stripAnsi, calculateDisplayWidth, convertAnsiToHtml } from './pkg/ascii_ansi_table.js';
        
        let wasmModule = null;
        
        async function initializeWasm() {
            try {
                wasmModule = await init();
                document.getElementById('status').textContent = 'Ready to demonstrate ANSI colors!';
                document.getElementById('status').className = 'status ready';
                
                document.getElementById('demo-basic').disabled = false;
                document.getElementById('demo-formatting').disabled = false;
                document.getElementById('demo-256').disabled = false;
                document.getElementById('demo-true').disabled = false;
                document.getElementById('demo-complex').disabled = false;
                
                return true;
            } catch (error) {
                document.getElementById('status').textContent = 'Failed to load WASM module: ' + error.message;
                document.getElementById('status').className = 'status error';
                console.error('WASM initialization failed:', error);
                return false;
            }
        }
        
        
        function addDemoSection(title, ansiOutput, description) {
            const container = document.getElementById('demo-outputs');
            
            const section = document.createElement('div');
            section.className = 'demo-section';
            
            const htmlOutput = convertAnsiToHtml(ansiOutput);
            const strippedText = stripAnsi(ansiOutput);
            const displayWidth = calculateDisplayWidth(ansiOutput.split('\\n')[0] || '');
            
            section.innerHTML = `
                <h3>${title}</h3>
                <p>${description}</p>
                <h4>Table Output:</h4>
                <div class="html-output">${htmlOutput}</div>
                <p><strong>Stats:</strong> Display width: ${displayWidth} chars, 
                   Raw length: ${ansiOutput.length} chars, 
                   Stripped length: ${strippedText.length} chars</p>
            `;
            
            container.appendChild(section);
        }
        
        window.demoBasicColors = function() {
            if (!wasmModule) return;
            
            const data = [
                ['Color', 'Foreground', 'Background', 'Sample'],
                ['Black', '\\u001b[30mBlack text\\u001b[0m', '\\u001b[40m\\u001b[37m Black BG \\u001b[0m', '\\u001b[30m\\u001b[47mSample\\u001b[0m'],
                ['Red', '\\u001b[31mRed text\\u001b[0m', '\\u001b[41m\\u001b[37m Red BG \\u001b[0m', '\\u001b[31m\\u001b[47mSample\\u001b[0m'],
                ['Green', '\\u001b[32mGreen text\\u001b[0m', '\\u001b[42m\\u001b[30m Green BG \\u001b[0m', '\\u001b[32m\\u001b[47mSample\\u001b[0m'],
                ['Yellow', '\\u001b[33mYellow text\\u001b[0m', '\\u001b[43m\\u001b[30m Yellow BG \\u001b[0m', '\\u001b[33m\\u001b[40mSample\\u001b[0m'],
                ['Blue', '\\u001b[34mBlue text\\u001b[0m', '\\u001b[44m\\u001b[37m Blue BG \\u001b[0m', '\\u001b[34m\\u001b[47mSample\\u001b[0m'],
                ['Magenta', '\\u001b[35mMagenta text\\u001b[0m', '\\u001b[45m\\u001b[37m Magenta BG \\u001b[0m', '\\u001b[35m\\u001b[47mSample\\u001b[0m'],
                ['Cyan', '\\u001b[36mCyan text\\u001b[0m', '\\u001b[46m\\u001b[30m Cyan BG \\u001b[0m', '\\u001b[36m\\u001b[40mSample\\u001b[0m'],
                ['White', '\\u001b[37mWhite text\\u001b[0m', '\\u001b[47m\\u001b[30m White BG \\u001b[0m', '\\u001b[37m\\u001b[40mSample\\u001b[0m']
            ];
            
            const table = new WasmTable();
            table.setData(data);
            const output = table.render();
            
            addDemoSection(
                'Basic 8-Color Palette',
                output,
                'Standard ANSI colors (30-37 foreground, 40-47 background) with proper table formatting.'
            );
        };
        
        window.demoFormatting = function() {
            if (!wasmModule) return;
            
            const data = [
                ['Formatting', 'Example', 'ANSI Code'],
                ['Normal', 'Regular text', 'No code'],
                ['Bold', '\\u001b[1mBold text\\u001b[0m', '\\u001b[1m...\\u001b[0m'],
                ['Italic', '\\u001b[3mItalic text\\u001b[0m', '\\u001b[3m...\\u001b[0m'],
                ['Underline', '\\u001b[4mUnderlined text\\u001b[0m', '\\u001b[4m...\\u001b[0m'],
                ['Strikethrough', '\\u001b[9mStrikethrough text\\u001b[0m', '\\u001b[9m...\\u001b[0m'],
                ['Dim', '\\u001b[2mDim text\\u001b[0m', '\\u001b[2m...\\u001b[0m'],
                ['Combined', '\\u001b[1m\\u001b[4m\\u001b[31mBold Red Underlined\\u001b[0m', 'Multiple codes']
            ];
            
            const table = new WasmTable();
            table.setData(data);
            const output = table.render();
            
            addDemoSection(
                'Text Formatting Options',
                output,
                'Various ANSI text formatting options demonstrating bold, italic, underline, and combined effects.'
            );
        };
        
        window.demo256Colors = function() {
            if (!wasmModule) return;
            
            const data = [
                ['256-Color Palette', 'Foreground', 'Background'],
                ['Bright Red', '\\u001b[38;5;196mBright Red Text\\u001b[0m', '\\u001b[48;5;196m\\u001b[30m Red BG \\u001b[0m'],
                ['Orange', '\\u001b[38;5;208mOrange Text\\u001b[0m', '\\u001b[48;5;208m\\u001b[30m Orange BG \\u001b[0m'],
                ['Bright Green', '\\u001b[38;5;46mBright Green Text\\u001b[0m', '\\u001b[48;5;46m\\u001b[30m Green BG \\u001b[0m'],
                ['Sky Blue', '\\u001b[38;5;117mSky Blue Text\\u001b[0m', '\\u001b[48;5;117m\\u001b[30m Blue BG \\u001b[0m'],
                ['Purple', '\\u001b[38;5;129mPurple Text\\u001b[0m', '\\u001b[48;5;129m\\u001b[37m Purple BG \\u001b[0m'],
                ['Gray Scale', '\\u001b[38;5;240mDark Gray\\u001b[0m', '\\u001b[48;5;240m\\u001b[37m Gray BG \\u001b[0m']
            ];
            
            const table = new WasmTable();
            table.setData(data);
            const output = table.render();
            
            addDemoSection(
                '256-Color Palette Sample',
                output,
                'Extended color palette using 256-color mode (38;5;n for foreground, 48;5;n for background).'
            );
        };
        
        window.demoTrueColor = function() {
            if (!wasmModule) return;
            
            const data = [
                ['True Color (RGB)', 'Example', 'RGB Values'],
                ['Coral', '\\u001b[38;2;255;127;80mCoral Text\\u001b[0m', 'rgb(255, 127, 80)'],
                ['Teal', '\\u001b[38;2;0;128;128mTeal Text\\u001b[0m', 'rgb(0, 128, 128)'],
                ['Gold', '\\u001b[38;2;255;215;0mGold Text\\u001b[0m', 'rgb(255, 215, 0)'],
                ['Violet', '\\u001b[38;2;138;43;226mViolet Text\\u001b[0m', 'rgb(138, 43, 226)'],
                ['Combined', '\\u001b[38;2;255;255;255m\\u001b[48;2;75;0;130mWhite on Indigo\\u001b[0m', 'Custom combo']
            ];
            
            const table = new WasmTable();
            table.setData(data);
            const output = table.render();
            
            addDemoSection(
                'True Color (24-bit RGB)',
                output,
                'Full RGB color support using true color ANSI sequences (38;2;r;g;b for foreground, 48;2;r;g;b for background).'
            );
        };
        
        window.demoComplexTable = function() {
            if (!wasmModule) return;
            
            const data = [
                [
                    '\\u001b[1m\\u001b[4m\\u001b[34mProduct\\u001b[0m',
                    '\\u001b[1m\\u001b[4m\\u001b[32mPrice\\u001b[0m',
                    '\\u001b[1m\\u001b[4m\\u001b[33mStatus\\u001b[0m',
                    '\\u001b[1m\\u001b[4m\\u001b[35mNotes\\u001b[0m'
                ],
                [
                    '\\u001b[1mLaptop\\u001b[0m',
                    '\\u001b[32m$999.99\\u001b[0m',
                    '\\u001b[42m\\u001b[30m IN STOCK \\u001b[0m',
                    '\\u001b[3mFast shipping\\u001b[0m'
                ],
                [
                    '\\u001b[1mMouse\\u001b[0m',
                    '\\u001b[32m$29.99\\u001b[0m',
                    '\\u001b[43m\\u001b[30m LOW STOCK \\u001b[0m',
                    '\\u001b[33m‚ö† Only 3 left\\u001b[0m'
                ],
                [
                    '\\u001b[1mKeyboard\\u001b[0m',
                    '\\u001b[31m\\u001b[9m$199.99\\u001b[0m \\u001b[32m$149.99\\u001b[0m',
                    '\\u001b[41m\\u001b[37m OUT OF STOCK \\u001b[0m',
                    '\\u001b[31m‚ùå Discontinued\\u001b[0m'
                ],
                [
                    '\\u001b[1mMonitor\\u001b[0m',
                    '\\u001b[32m$299.99\\u001b[0m',
                    '\\u001b[46m\\u001b[30m PRE-ORDER \\u001b[0m',
                    '\\u001b[36müìÖ Ships next week\\u001b[0m'
                ]
            ];
            
            const table = new WasmTable();
            table.setData(data);
            const output = table.render();
            
            addDemoSection(
                'Complex Mixed Formatting',
                output,
                'Real-world example with bold headers, colored prices, status indicators, strikethrough text, and emoji support.'
            );
        };
        
        window.clearOutputs = function() {
            document.getElementById('demo-outputs').innerHTML = '';
        };
        
        initializeWasm();
    </script>
</body>
</html>