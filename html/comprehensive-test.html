<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII ANSI Table WASM - Comprehensive Test Suite</title>
    <style>
        :root {
            --dracula-bg: #282a36;
            --dracula-current-line: #44475a;
            --dracula-selection: #44475a;
            --dracula-foreground: #f8f8f2;
            --dracula-comment: #6272a4;
            --dracula-cyan: #8be9fd;
            --dracula-green: #50fa7b;
            --dracula-orange: #ffb86c;
            --dracula-pink: #ff79c6;
            --dracula-purple: #bd93f9;
            --dracula-red: #ff5555;
            --dracula-yellow: #f1fa8c;
        }
        
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: var(--dracula-bg);
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(189, 147, 249, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(255, 121, 198, 0.1) 0%, transparent 50%);
            color: var(--dracula-foreground);
            min-height: 100vh;
        }
        
        .container {
            background: rgba(68, 71, 90, 0.6);
            backdrop-filter: blur(12px);
            padding: 35px;
            border-radius: 20px;
            border: 1px solid rgba(189, 147, 249, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 4px 16px rgba(189, 147, 249, 0.1),
                inset 0 1px 0 rgba(248, 248, 242, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            margin-bottom: 25px;
        }
        
        h1 {
            color: var(--dracula-purple);
            text-align: center;
            text-shadow: 0 2px 8px rgba(189, 147, 249, 0.3), 0 0 20px rgba(189, 147, 249, 0.2);
            border-bottom: 2px solid var(--dracula-purple);
            padding-bottom: 15px;
            font-size: 2.2em;
            letter-spacing: -0.02em;
        }
        
        .test-result {
            margin: 18px 0;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .test-result.pass {
            background: linear-gradient(145deg, rgba(80, 250, 123, 0.15), rgba(80, 250, 123, 0.05));
            border-color: rgba(80, 250, 123, 0.4);
            box-shadow: 0 4px 16px rgba(80, 250, 123, 0.1), inset 0 1px 0 rgba(248, 248, 242, 0.05);
        }
        
        .test-result.fail {
            background: linear-gradient(145deg, rgba(255, 85, 85, 0.15), rgba(255, 85, 85, 0.05));
            border-color: rgba(255, 85, 85, 0.4);
            box-shadow: 0 4px 16px rgba(255, 85, 85, 0.1), inset 0 1px 0 rgba(248, 248, 242, 0.05);
        }
        
        .test-result.running {
            background: linear-gradient(145deg, rgba(241, 250, 140, 0.15), rgba(241, 250, 140, 0.05));
            border-color: rgba(241, 250, 140, 0.4);
            box-shadow: 0 4px 16px rgba(241, 250, 140, 0.1), inset 0 1px 0 rgba(248, 248, 242, 0.05);
        }
        
        .test-output {
            background: rgba(40, 42, 54, 0.9);
            color: var(--dracula-foreground);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 350px;
            overflow-y: auto;
            border: 1px solid rgba(139, 233, 253, 0.2);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(248, 248, 242, 0.05);
        }
        
        .controls {
            margin: 25px 0;
            text-align: center;
        }
        
        button {
            background: linear-gradient(145deg, var(--dracula-purple), var(--dracula-pink));
            color: var(--dracula-bg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            margin: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            box-shadow: 
                0 4px 16px rgba(189, 147, 249, 0.3),
                0 2px 8px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -2px 0 rgba(0, 0, 0, 0.2);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 24px rgba(189, 147, 249, 0.4),
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -2px 0 rgba(0, 0, 0, 0.2);
            background: linear-gradient(145deg, var(--dracula-pink), var(--dracula-purple));
        }
        
        button:active:not(:disabled) {
            transform: translateY(-1px) scale(1.01);
            box-shadow: 
                0 4px 12px rgba(189, 147, 249, 0.3),
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(0, 0, 0, 0.1),
                inset 0 -1px 0 rgba(255, 255, 255, 0.1);
        }
        
        button:disabled {
            background: linear-gradient(145deg, var(--dracula-comment), #5a6374);
            color: var(--dracula-selection);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            border-color: rgba(98, 114, 164, 0.3);
        }
        
        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--dracula-current-line);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            z-index: 1000;
        }
        
        .summary {
            background: linear-gradient(145deg, rgba(68, 71, 90, 0.8), rgba(68, 71, 90, 0.4));
            border: 1px solid rgba(139, 233, 253, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(248, 248, 242, 0.05);
        }
        
        .benchmark-info {
            font-size: 0.9em;
            color: var(--dracula-comment);
            margin-top: 8px;
        }
        
        .ansi-preview {
            background: rgba(40, 42, 54, 0.95);
            border: 1px solid rgba(139, 233, 253, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 8px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .html-preview {
            background: rgba(248, 248, 242, 0.95);
            color: var(--dracula-bg);
            border: 1px solid rgba(189, 147, 249, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 8px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .back-link {
            display: inline-block;
            background: linear-gradient(145deg, var(--dracula-comment), #5a6374);
            color: var(--dracula-foreground);
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 10px;
            margin: 12px 0;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 4px 16px rgba(98, 114, 164, 0.2),
                0 2px 8px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .back-link:hover {
            background: linear-gradient(145deg, #5a6374, var(--dracula-comment));
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px rgba(98, 114, 164, 0.3),
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="status-bar" id="status-bar">
        Loading WASM module...
    </div>
    
    <div style="margin-top: 60px;">
        <div style="text-align: left; margin: 0 0 30px 0;">
            <a href="index.html" class="back-link">&larr; Back to Test Directory</a>
        </div>
        
        <h1>🧪 ASCII ANSI Table WASM - Comprehensive Test Suite</h1>
        
        <div class="container">
            <div class="controls">
                <button id="run-all-btn" onclick="runAllTests()" disabled>Run All Tests</button>
                <button id="run-functional-btn" onclick="runFunctionalTests()" disabled>Run Functional Tests</button>
                <button id="run-perf-btn" onclick="runPerformanceTests()" disabled>Run Performance Tests</button>
                <button onclick="clearResults()">Clear Results</button>
            </div>
            
            <div class="summary" id="summary" style="display: none;">
                <strong>Test Summary:</strong>
                <span id="summary-text"></span>
            </div>
        </div>
        
        <div class="container">
            <h2>Test Results</h2>
            <div id="test-results"></div>
        </div>
    </div>

    <script type="module">
        import init, { 
            WasmTable, 
            table, 
            getBorderCharacters, 
            validateTableData, 
            calculateColumnWidths, 
            wrapText, 
            calculateDisplayWidth, 
            stripAnsi,
            convertAnsiToHtml
        } from './pkg/ascii_ansi_table.js';
        
        import { 
            createSimpleTable, 
            createColorfulTable, 
            createMixedLengthTable,
            createUnicodeTable,
            createComplexAnsiTable,
            measureTime,
            debug,
            assert
        } from './test-utils.js';
        
        import { createFunctionalTestSuite } from './test-suite-synchronized.js';
        import { createPerformanceTestSuite } from './test-suite-performance.js';
        
        let wasmModule = null;
        let testResults = [];
        
        // Initialize WASM module
        async function initializeWasm() {
            try {
                wasmModule = await init();
                document.getElementById('status-bar').textContent = 'WASM module loaded successfully!';
                document.getElementById('status-bar').style.background = 'linear-gradient(145deg, var(--dracula-green), #45e066)';
                
                // Enable buttons
                document.getElementById('run-all-btn').disabled = false;
                document.getElementById('run-functional-btn').disabled = false;
                document.getElementById('run-perf-btn').disabled = false;
                
                console.log('WASM module initialized successfully');
                return true;
            } catch (error) {
                document.getElementById('status-bar').textContent = 'Failed to load WASM module: ' + error.message;
                document.getElementById('status-bar').style.background = 'linear-gradient(145deg, var(--dracula-red), #e04545)';
                console.error('WASM initialization failed:', error);
                return false;
            }
        }
        
        
        function displayTestResult(result) {
            const resultsContainer = document.getElementById('test-results');
            
            const testDiv = document.createElement('div');
            testDiv.className = `test-result ${result.status.toLowerCase()}`;
            
            let content = `
                <h3>${result.name} - ${result.status}</h3>
                <div class="benchmark-info">
                    ${result.description || 'No description'}
                    ${result.creationTime ? `• Creation: ${result.creationTime.toFixed(2)}ms` : ''}
                    ${result.renderTime ? `• Render: ${result.renderTime.toFixed(2)}ms` : ''}
                    ${result.maxLineLength ? `• Max line length: ${result.maxLineLength}` : ''}
                    ${result.lineCount ? `• Lines: ${result.lineCount}` : ''}
                    ${result.charCount ? `• Characters: ${result.charCount.toLocaleString()}` : ''}
                    ${result.performance ? Object.entries(result.performance).map(([key, value]) => 
                        `• ${key}: ${typeof value === 'number' ? value.toLocaleString() : value}`
                    ).join(' ') : ''}
                </div>
            `;
            
            if (result.error) {
                content += `<div style="color: red; margin: 10px 0;"><strong>Error:</strong> ${result.error}</div>`;
            }
            
            if (result.result) {
                let sampleOutput = '';
                if (result.result.output) {
                    const lines = result.result.output.split('\n');
                    const sampleLines = lines.slice(0, 20);
                    if (lines.length > 20) {
                        sampleLines.push(`... (${lines.length - 20} more lines)`);
                    }
                    sampleOutput = sampleLines.join('\n');
                }
                
                if (result.result.htmlOutput) {
                    content += `<div class="html-preview">${result.result.htmlOutput}</div>`;
                } else if (sampleOutput) {
                    const htmlOutput = convertAnsiToHtml(sampleOutput);
                    content += `<div class="html-preview">${htmlOutput}</div>`;
                }
                
                if (result.name.includes('Performance') && sampleOutput) {
                    content += `
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer; font-weight: bold;">📋 Raw Table Sample (first 20 lines)</summary>
                            <pre style="background: rgba(40, 42, 54, 0.9); color: var(--dracula-foreground); padding: 15px; border-radius: 8px; overflow-x: auto; max-height: 300px; overflow-y: auto; margin-top: 10px; border: 1px solid rgba(139, 233, 253, 0.2); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);">${sampleOutput}</pre>
                        </details>
                    `;
                }
            }
            
            testDiv.innerHTML = content;
            resultsContainer.appendChild(testDiv);
        }
        
        function updateSummary() {
            const summary = document.getElementById('summary');
            const summaryText = document.getElementById('summary-text');
            
            if (testResults.length === 0) {
                summary.style.display = 'none';
                return;
            }
            
            const passed = testResults.filter(r => r.status === 'PASS').length;
            const failed = testResults.filter(r => r.status === 'FAIL').length;
            const total = testResults.length;
            
            summaryText.textContent = `${passed}/${total} tests passed (${failed} failed)`;
            summary.style.display = 'block';
            summary.style.background = failed === 0 ? 'linear-gradient(145deg, rgba(80, 250, 123, 0.2), rgba(80, 250, 123, 0.1))' : 'linear-gradient(145deg, rgba(255, 85, 85, 0.2), rgba(255, 85, 85, 0.1))';
            summary.style.border = failed === 0 ? '1px solid rgba(80, 250, 123, 0.3)' : '1px solid rgba(255, 85, 85, 0.3)';
            summary.style.color = 'var(--dracula-foreground)';
        }
        
        window.runFunctionalTests = async function() {
            if (!wasmModule) {
                alert('WASM module not initialized');
                return;
            }
            
            document.getElementById('run-functional-btn').disabled = true;
            document.getElementById('status-bar').textContent = 'Running functional tests...';
            document.getElementById('status-bar').style.background = 'linear-gradient(145deg, var(--dracula-yellow), #f4e479)';
            
            try {
                const testSuite = createFunctionalTestSuite(WasmTable, convertAnsiToHtml, stripAnsi);
                
                for (const test of testSuite.tests) {
                    const testDiv = document.createElement('div');
                    testDiv.className = 'test-result running';
                    testDiv.innerHTML = `<h3>${test.name} - RUNNING</h3>`;
                    document.getElementById('test-results').appendChild(testDiv);
                    
                    try {
                        const result = await test.testFn();
                        testResults.push({
                            name: test.name,
                            status: 'PASS',
                            result: result,
                            error: null,
                            description: result.description,
                            creationTime: result.creationTime,
                            renderTime: result.renderTime,
                            maxLineLength: result.maxLineLength,
                            lineCount: result.lineCount
                        });
                        
                        testDiv.remove();
                        displayTestResult(testResults[testResults.length - 1]);
                    } catch (error) {
                        testResults.push({
                            name: test.name,
                            status: 'FAIL',
                            result: null,
                            error: error.message,
                            description: null
                        });
                        
                        testDiv.remove();
                        displayTestResult(testResults[testResults.length - 1]);
                    }
                    
                    updateSummary();
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                document.getElementById('status-bar').textContent = 'Functional tests completed!';
                document.getElementById('status-bar').style.background = 'linear-gradient(145deg, var(--dracula-green), #45e066)';
                
            } catch (error) {
                document.getElementById('status-bar').textContent = 'Test execution failed: ' + error.message;
                document.getElementById('status-bar').style.background = 'linear-gradient(145deg, var(--dracula-red), #e04545)';
                console.error('Test execution failed:', error);
            }
            
            document.getElementById('run-functional-btn').disabled = false;
        };
        
        window.runPerformanceTests = async function() {
            if (!wasmModule) {
                alert('WASM module not initialized');
                return;
            }
            
            document.getElementById('run-perf-btn').disabled = true;
            document.getElementById('status-bar').textContent = 'Running performance tests...';
            document.getElementById('status-bar').style.background = 'linear-gradient(145deg, var(--dracula-yellow), #f4e479)';
            
            try {
                const testSuite = createPerformanceTestSuite(WasmTable, measureTime);
                
                for (const test of testSuite.tests) {
                    const testDiv = document.createElement('div');
                    testDiv.className = 'test-result running';
                    testDiv.innerHTML = `<h3>${test.name} - RUNNING</h3><p>⏳ This may take a moment for large tables...</p>`;
                    document.getElementById('test-results').appendChild(testDiv);
                    
                    try {
                        const result = await test.testFn();
                        testResults.push({
                            name: test.name,
                            status: 'PASS',
                            result: result,
                            error: null,
                            description: result.description,
                            creationTime: result.creationTime,
                            renderTime: result.renderTime,
                            maxLineLength: result.maxLineLength,
                            lineCount: result.lineCount,
                            charCount: result.charCount,
                            performance: result.performance
                        });
                        
                        testDiv.remove();
                        displayTestResult(testResults[testResults.length - 1]);
                    } catch (error) {
                        testResults.push({
                            name: test.name,
                            status: 'FAIL',
                            result: null,
                            error: error.message,
                            description: null
                        });
                        
                        testDiv.remove();
                        displayTestResult(testResults[testResults.length - 1]);
                    }
                    
                    updateSummary();
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                document.getElementById('status-bar').textContent = 'Performance tests completed!';
                document.getElementById('status-bar').style.background = 'linear-gradient(145deg, var(--dracula-green), #45e066)';
                
            } catch (error) {
                document.getElementById('status-bar').textContent = 'Performance test execution failed: ' + error.message;
                document.getElementById('status-bar').style.background = 'linear-gradient(145deg, var(--dracula-red), #e04545)';
                console.error('Performance test execution failed:', error);
            }
            
            document.getElementById('run-perf-btn').disabled = false;
        };

        window.runAllTests = async function() {
            await runFunctionalTests();
            await runPerformanceTests();
        };
        
        window.clearResults = function() {
            testResults = [];
            document.getElementById('test-results').innerHTML = '';
            updateSummary();
        };
        
        initializeWasm();
    </script>
</body>
</html>